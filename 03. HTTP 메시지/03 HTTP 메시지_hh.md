# 3장 HTTP 메시지

### 메시지의 흐름

- HTTP 메시지 : HTTP 애플리케이션 간에 주고받은 데이터의 블록들.
- 이 데이터 블록들은 메시지의 내용과 의미를 설명하는 테긋트 메타 정보로 시작하고 그 다음에 선택적으로 데이터가 올 수 있음.
- 이 메시지는 클라이언트, 서버, 프락시 사이를 흐름.

### 메시지의 각 부분

- 각 메시지는 클라이언트로부터의 요청이나 서버로부터의 응답 중 하나를 포함함.
- 메시지는 시작줄, 헤더 블록, 본문 이렇게 세 부분으로 이루어짐.
- CRLF(Carriege Return and Line Feed) : 보통 HTTP 헤더의 끝 라인에 들어가 각 라인을 구분하는 구분자로 사용.
- 시작줄이나 헤더와는 달리, 본문은 텍스트나 이진 데이터를 포함할 수도 있고 그냥 비어있을 수도 있음.

### 메시지 문법

    * 요청 메시지의 형식
    <메서드> <요청 URL> <버전>
    <헤더>
    
    <엔티티 본문>


    * 응답 메시지의 형식
    <버전> <상태 코드> <사유 구절>
    <헤더>

    <엔터티 본문>

- 메서드 : 클라이언트 측에서 서버가 리소스에 대해 수행해주길 바라는 동작.
- 요청 URL : 요청 대상이 된느 리소스를 지칭하는 완전한 URL 혹은 URL의 경로 구성요소.
- 버전 : 메시지에서 사용 중인 HTTP 버전.

    HTTP/<메이저><마이너>

- 상태 코드 : 요청 중에 무엇이 일어났는지 설명하는 세 자리의 숫자.
- 사유 구절(response phrase) : 숫자로 된 상태 코드의 의미를 사람이 이해할 수 있게 설명해주는 짧은 문구로, 상태 코드 이후부터 줄바꿈 문자열까지가 사유 구절.
- 헤더들 : 이름, 콜론(:), 선택적인 공백, 값, CRLF가 순서대로 나타나는 0개 이상의 헤더.
    - 헤더의 목록은 빈 줄(CRLF)로 끝나 헤더 목록의 끝과 엔티티 본문의 시작을 표시함.
- 엔티티 본문 : 임의의 데이터 블록을 포함하며, 모든 메시지가 엔티티 본문을 갖는 것은 아니므로 때때로 메시지는 그냥 CRLF로 끝나게 됨.

### 시작줄

- 모든 HTTP 메시지는 시작줄로 시작되며 요청 메시지의 시작줄은 무엇을 해야하는지 알려주고, 응답 메시지의 시작줄은 무슨 일이 일어났는지 말해줌.
- 요청줄 : 요청 메시지의 시작줄, 혹은 요청줄에는 서버에서 어떤 동작이 일어나야 하는지 설명해주는 메서드와 그 동작에 대한 대상을 지칭하는 요청 URL이 들어있음.
    - 클라이언트가 어떤 HTTP 버전으로 말하고 있는지 서버에게 알려주는 HTTP 버전도 포함하며, 이 모든 필드는 공백으로 구분됨.
- 응답줄 : 응답 메시지는수행 결과에 대한 상태 정보와 결과 데이터를 클라이언트에게 돌려줌.
    - 응답 메시지의 시작줄 혹은 응답줄에는 응답 메시지에서 쓰인 HTTP의 버전, 숫자로 된 상태 코드, 수행 상태에 대해 설명해주는 텍스트로 된 사유 구절이 들어 있으며 이 모든 필드는 공백으로 구분됨.
- 메서드 : 요청의 시작줄은 메서드로 시작하며, 서버에게 무엇을 해야 하는지 말해줌.
    - HTTP 명세는 공통 요청 메서드의 집합을 정의함.
- 상태 코드 : 클라이언트에게 무엇이 일어났는지 말해주며, 응답의 시작줄에 위치함.
    - 상태 코드는 각 응답 메시지의 시작줄에 담겨 반환됨.
    - 숫자로 된 코드와 문자열로 되어 있어서 사람이 이해하기 쉬운 메시지 두 형태 모두로 반환됨.
    - 상태코드들은 세 자리 숫자로 된 그들의 코드값을 기준으로 묶임.
- 사유 구절 : 응답 시작줄의 마지막 구성요소로, 상태 코드에 대한 글로 된 설명을 제공함.
    - 사유 구절은 상태 코드와 일대 일로 대응되며 애플리케이션 개발자들이 그들의 사용자에게 요청 중에 무슨 일이 일어났는지 알려주기 위해 넘겨줄 수 있는 상태 코드의 사람이 이해하기 쉬운 버전.
    - HTTP 명세는 사유 구절이 어때야 한다는 어떤 엄격한 규칙도 제공하지 않음.
- 버전 번호 : HTTP/x.y 형식으로 요청과 응답 메시지 양쪽 모두에 기술됨.
    - 버전 번호는 HTTP로 대화하는 애플리케이션에게 대화 상대의 능력과 메시지의 형식에 대한 단서를 제공해주기 위한 것. 
    - ex) HTTP 버전 1.1 애플리케이션과 대화하는 HTTP 버전 1.2 버전의 새로운 기능을 사용할 수 없음.

### 헤더

- HTTP 헤더 필드는 요청과 응답 메시지에 추가 정보를 더함.
- 기본적으로 이름/값 쌍의 목록. ex) Content-length: 19
- 헤더 분류 : HTTP 헤더 명세는 여러 헤더 필드를 정의함.
    - 일반 헤더 : 요청과 응답 양쪽에 모두 나타날 수 있음.
    - 요청 헤더 : 요청에 대한 부가 정보를 제공.
    - 응답 헤더 : 응답에 대한 부가 정보를 제공.
    - Entity 헤더 : 본문 크기와 콘텐츠, 혹은 리소스 그 자체를 서술.
    - 확장 헤더 : 명세에 정의되지 않은 새로운 헤더.

### 엔티티 본문

- HTTP  메시지의 세 번째 부분은 선택적인 엔티티 본문임.
- 엔티티 본문은 HTTP 메시지의 화물이라고 할 수 있고, 그것들은 HTTP가 수송하도록 설계된 것들임.
- HTTP 메시지는 이미지, 비디오, HTML 문서, 소프트웨어 애플리케이션, 신용카드 트랜잭션, 전자우편 등 여러 종류의 디지털 데이터를 실어 나를 수 있음.

### 메서드

- 모든 서버가 모든 메서드를 구현하지는 않음.
- HTTP 버전 1.1과 호환되고자 한다면, 서버는 자신의 리소스에 대해 GET, HEAD 메서드만을 구현하는 것으로 충분함.
- 비록 서버가 모든 메서드를 구현하지 않았다 하더라도 메서드는 대부분 제한적으로 사용될 것이며 이 제한은 일반적으로 서버 설정에 의해 정해지며, 사이트마다 또 서버마다 다를 수 있음.

### 안전한 메서드

- HTTP는 안전한 메서드라 불리는 메서드의 집합을 정의함.
- GET과 HEAD 메서드는 안전하다고 할 수 있는데 이는 GET이나 HEAD 메서드를 사용하는 HTTP 요청의 결과로 서버에 어떤 작용도 없음을 의미함.
    - 작용이 없다는 것은 HTTP 요청의 결과로 인해 서버에서 일어나는 일은 아무것도 없다는 의미.
- 안전한 메서드의 목적은 서버에 어떤 영향을 줄 수 있는 안전하지 않은 메서드가 사용될 때 사용자들에게 그 사실을 알려주는 HTTP 애플리케이션을 만들 수 있도록 하는 것에 있음.

### GET

- 주로 서버에게 리소스를 달라고 요청하기 위해 쓰이며, HTTP/1.1은 서버가 이 메서드를 구현할 것을 요구함.

### HEAD

- 정확히 GET처럼 행동하지만, 서버는 응답으로 헤더만을 돌려줌.
- 엔티티 본문은 결과 반환되지 않으며, 이는 클라이언트가 리소스를 실제로 가져올 필요 없이 헤더만을 조사할 수 있도록 해줌.

### PUT

- GET 메서드가 서버로부터 문서를 읽어 들이는데 반해 PUT 메서드는 서버에 문서를 씀.
- 어떤 발행 시스템은 사용자가 PUT을 이용해 웹페이지를 만들고 웹 서버에 직접 게시할 수 있도록 함.
- 서버가 요청의 본문을 가지고 요청 URL의 이름대로 새 문서를 만들거나, 이미 URL이 존재한다면 본문을 사용해서 교체하는 것.
- PUT은 콘텐츠를 변경할 수 있게 해주기 떄문에, 많은 웹 서버가 PUT을 수행하기 전에 사용자가에게 비밀번호를 입력해서 로그인을 하도록 요구함.

### POST

- 서버에 입력 데이터를 전송하기 위해 설계됨.
- HTML 폼을 지원하기 위해 흔해 사용되고, 채워진 폼에 담긴 데이터는 서버로 전송되며, 서버는 이를 모아서 필요로 하는 곳에 보냄.

### TRACE

- TRACE 메서드는 클라이언트에게 자신의 요청이 서버에 도달했을 때 어떻게 보이게 되는지 알려줌.
- 요청 전송의 마지막 단계에 있는 서버는 자신이 받은 요청 메시지를 본문에 넣어 TRACE 응답을 되돌려줌.
- 클라이언트는 자신과 목적지 서버 사이에 있는 모든 HTTP 애플리케이션의 요청/응답 연쇄를 따라가면서 자신이 보낸 메시지가 망가졌거나 수정되었는지, 만약 그렇다면 어떻게 변경되었는지 확인할 수 있음.
- TRACE 메서드는 **주로 진단을 위해 사용**됨.

    ex) 요청이 의도한 요청/응답 연쇄를 거쳐가는지 검사할 수 있음.

### OPTIONS

- 웹 서버에게 여러 가지 종류의 지원 범위에 대해 물어봄.
- 몇몇 서버는 특정 종류의 객체에 대해 특정 동작만을 지원함.
- 이 메서드는 여러 리소스에 대해 실제로 접근하지 않고도 그것들을 어떻게 접근하는 것이 최선인지 확인할 수 있는 수단을 클라이언트 애플리케이션에게 제공함.

### DELETE

- 서버에게 요청 URL로 지정한 리소스를 삭제할 것을 요청함.
- HTTP 명세는 서버가 클라이언트에게 알리지 않고 요청을 무시하는 것을 허용하기 때문에 클라이언트는 삭제가 수행되는 것을 보장하지 못함.

### 상태코드

- 상태 코드는 클라이언트에게 그들의 트랜잭션을 이해할 수 있는 쉬운 방법을 제공함.
- 100-199 : 정보성 상태 코드
- 200-299 : 성공 상태 코드
- 300-399 : 리다이렉션 상태 코드 
- 400-499 : 클라이언트 에러 상태 코드 
- 500-599 : 서버 에러 상태 코드

### 헤더

- 헤더와 메서드는 클라이언트와 서버가 무엇을 결정하기 위해 함께 사용됨.
- 헤더에는 특정 종류의 메시지에만 사용할 수 있는 헤더와 더 일반 목적으로 사용할 수 있는 헤더, 응답과 요청 메시지 양쪽 모두에서 정보를 제공하는 헤더가 있음.
- 일반 헤더(General Headers) : 클라이언트와 서버 양쪽 모두가 사용함. 이들은 클라이언트, 서버, 그리고 어딘가에 메시지를 보내는 다른 애플리케이션들을 위해 다양한 목적으로 사용됨.
- 요청 헤더(Request Headers) : 이름에서 드러나는 것과 같이, 요청 헤더는 요청 메시지를 위한 헤더로 서버에게 클라이언트가 받고자 하는 데이터의 타입이 무엇인지와 같은 부가 정보를 제공함.
- 응답 헤더(Response Headers) : 클라이언트에게 정보를 제공하기 위한 자신만의 헤더를 갖고 있음.
- 엔티티 헤더(Entity Headers) : 엔티티 본문에 대한 헤더를 의미함.
- 확장 헤더(Extension Headers) : 애플리케이션 개발자들에 의해 만들어졌지만 아직 승인된 HTTP 명세에는 추가되지 않은 비표준 헤더.

### 일반 헤더

- 메시지에 대한 아주 기본적인 정보를 제공하며, 이 헤더들은 일반 헤더라고 불림.
- 메시지가 어떤 종류이든 상관없이 유용한 정보를 제공함.

### 요청 헤더

- 요청 메시지에서만 의미를 갖는 헤더로 요청이 최초 발생한 곳에서 누가 혹은 무엇이 그 요청을 보냈는지에 대한 정보나 클라이언트의 선호나 능력에 대한 정보를 줌.
- 서버는 요청 헤더가 준 클라이언트에 대한 그 정보를 클라이언트에게 더 나은 응답을 주기 위해 활용할 수 있음.

### 응답 헤더

- 응답 메시지는 그들만의 응답 헤더를 가지며, 클라이언트에게 정보를 제공함.
- 누가 응답을 보내고 있는지 혹은 응답자의 능력은 어떻게 되는지 알려주며, 더 나아가 응답에 대한 특별한 설명도 제공할 수 있음.
